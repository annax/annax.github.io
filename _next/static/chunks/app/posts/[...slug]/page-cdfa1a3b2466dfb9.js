(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{1115:(e,t,n)=>{Promise.resolve().then(n.bind(n,7678)),Promise.resolve().then(n.bind(n,6852)),Promise.resolve().then(n.t.bind(n,2619,23)),Promise.resolve().then(n.t.bind(n,1356,23))},6852:(e,t,n)=>{"use strict";n.d(t,{default:()=>s});var r=n(5155),l=n(2115);let i=(0,l.forwardRef)((e,t)=>{let{id:n,title:i,isActive:s,isPlaying:o,onPlayStateChange:c}=e,a=(0,l.useRef)(null),u=(0,l.useRef)(null),[d,h]=(0,l.useState)("");return(0,l.useEffect)(()=>{i?h(i):(h("正在获取歌名..."),(async()=>{try{let e=await fetch("https://api.injahow.cn/meting/?type=song&id=".concat(n));if(e.ok){let t=await e.json(),n=Array.isArray(t)?t[0]:t;if(n&&n.name)return void h(n.artist?"".concat(n.name," - ").concat(n.artist):n.name)}h("网易云音乐 ".concat(n))}catch(e){h("网易云音乐 ".concat(n))}})())},[n,i]),(0,l.useEffect)(()=>{if(a.current)if(o){if(a.current.paused){a.current.src="https://music.163.com/song/media/outer/url?id=".concat(n,".mp3");let e=a.current.play();u.current=e,void 0!==e&&e.then(()=>{u.current=null}).catch(e=>{u.current=null,"AbortError"!==e.name&&(console.log("Autoplay blocked:",e),c(!1))})}}else(!a.current.paused||u.current)&&(u.current&&(u.current.catch(()=>{}),u.current=null),a.current.pause())},[o,n,c]),(0,r.jsx)("div",{ref:t,className:"sticky z-40 transition-all duration-500 transform my-2",style:{top:"5rem"},children:(0,r.jsxs)("div",{className:"px-3 py-1 flex flex-row items-center gap-4 transition-colors duration-300 rounded-lg",style:{backgroundColor:"var(--color-bg-secondary)"},children:[(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4 flex-shrink-0 transition-opacity duration-300 ".concat(o?"opacity-100":"opacity-50"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-text-secondary)"},children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,r.jsx)("span",{className:"text-sm font-medium truncate transition-opacity duration-300 ".concat(s?"opacity-100":"opacity-50"),style:{color:"var(--color-text)"},title:d,children:d})]})}),(0,r.jsx)("button",{onClick:()=>{s&&c(!o)},disabled:!s,className:"py-1 transition-all duration-300 ".concat(s?"opacity-100 cursor-pointer":"opacity-50 cursor-not-allowed"),title:s?o?"暂停":"播放":"未激活",children:o?(0,r.jsxs)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-accent)"},children:[(0,r.jsx)("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),(0,r.jsx)("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-text)"},children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,r.jsx)("audio",{ref:a,onEnded:()=>{c(!1)},onPause:()=>{o&&c(!1)},onPlay:()=>{o||c(!0)},onError:e=>{console.error("Audio error",e),c(!1)}})]})})});function s(e){let{htmlContent:t}=e,n=(0,l.useMemo)(()=>(function(e){let t,n=[],r=/<music\s+id=["']([^"']+)["'](?:\s+title=["']([^"']*)["'])?\s*(?:\/?>|>\s*<\/music>)/gi,l=[];for(;null!==(t=r.exec(e));)l.push({index:t.index,length:t[0].length,id:t[1],title:t[2]});l.sort((e,t)=>e.index-t.index);let i=0;for(let t of l)t.index>i&&n.push({type:"html",content:e.slice(i,t.index)}),n.push({type:"music",content:"",id:t.id,title:t.title}),i=t.index+t.length;return i<e.length&&n.push({type:"html",content:e.slice(i)}),n.length>0?n:[{type:"html",content:e}]})(t),[t]),[s,o]=(0,l.useState)(null),[c,a]=(0,l.useState)(null),u=(0,l.useRef)(new Set),d=(0,l.useRef)(new Map),h=(0,l.useCallback)((e,t)=>{t?(a(e),u.current.add(e)):c===e&&a(null)},[c]);return(0,l.useEffect)(()=>{let e=()=>{let e=.5*window.innerHeight,t=null,r=[];if(d.current.forEach((t,n)=>{t.getBoundingClientRect().top<e&&r.push(n)}),r.length>0)for(let e=n.length-1;e>=0;e--){let l=n[e];if("music"===l.type&&l.id&&r.includes(l.id)){t=l.id;break}}o(t)};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>window.removeEventListener("scroll",e)},[n]),(0,l.useEffect)(()=>{s?u.current.has(s)?c&&c!==s&&a(null):(u.current.add(s),a(s)):a(null)},[s,c]),(0,r.jsx)("div",{className:"prose-content relative",children:n.map((e,t)=>"music"===e.type&&e.id?(0,r.jsx)(i,{ref:t=>{t?d.current.set(e.id,t):d.current.delete(e.id)},id:e.id,title:e.title,isActive:s===e.id,isPlaying:c===e.id,onPlayStateChange:t=>h(e.id,t)},t):(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:e.content}},t))})}i.displayName="StickyMusicPlayer"},7678:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var r=n(2115);function l(){return(0,r.useLayoutEffect)(()=>{window.scrollTo(0,0)},[]),null}}},e=>{e.O(0,[619,356,441,255,358],()=>e(e.s=1115)),_N_E=e.O()}]);