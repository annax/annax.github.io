(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{4455:(e,t,r)=>{Promise.resolve().then(r.bind(r,7678)),Promise.resolve().then(r.bind(r,6852)),Promise.resolve().then(r.t.bind(r,2619,23)),Promise.resolve().then(r.t.bind(r,1356,23))},6852:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(5155),l=r(2115);let i=(0,l.forwardRef)((e,t)=>{let{id:r,title:i,isActive:s,isPlaying:c,onPlayStateChange:o}=e,a=(0,l.useRef)(null),u=(0,l.useRef)(null),[d,h]=(0,l.useState)("");return(0,l.useEffect)(()=>{i?h(i):(h("正在获取歌名..."),(async()=>{try{let e=await fetch("https://api.injahow.cn/meting/?type=song&id=".concat(r));if(e.ok){let t=await e.json(),r=Array.isArray(t)?t[0]:t;if(r&&r.name)return void h(r.artist?"".concat(r.name," - ").concat(r.artist):r.name)}h("网易云音乐 ".concat(r))}catch(e){h("网易云音乐 ".concat(r))}})())},[r,i]),(0,l.useEffect)(()=>{if(!a.current)return;let e="https://music.163.com/song/media/outer/url?id=".concat(r,".mp3");if(a.current.src&&a.current.src===e||(a.current.src=e),c){if(a.current.paused){let e=a.current.play();u.current=e,void 0!==e&&e.then(()=>{u.current=null}).catch(e=>{u.current=null,"AbortError"!==e.name&&(console.log("Autoplay blocked:",e),o(!1))})}}else(!a.current.paused||u.current)&&(u.current&&(u.current.catch(()=>{}),u.current=null),a.current.pause())},[c,r,o]),(0,n.jsx)("div",{ref:t,className:"sticky z-40 transition-all duration-500 transform my-2",style:{top:"5rem"},children:(0,n.jsxs)("div",{className:"px-3 py-1 flex flex-row items-center gap-4 transition-colors duration-300 rounded-lg",style:{backgroundColor:"var(--color-bg-secondary)"},children:[(0,n.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 flex-shrink-0 transition-opacity duration-300 ".concat(c?"opacity-100":"opacity-50"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-text-secondary)"},children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,n.jsx)("span",{className:"text-sm font-medium truncate transition-opacity duration-300 ".concat(s?"opacity-100":"opacity-50"),style:{color:"var(--color-text)"},title:d,children:d})]})}),(0,n.jsx)("button",{onClick:()=>{s&&o(!c)},disabled:!s,className:"py-1 transition-all duration-300 ".concat(s?"opacity-100 cursor-pointer":"opacity-50 cursor-not-allowed"),title:s?c?"暂停":"播放":"未激活",children:c?(0,n.jsxs)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-accent)"},children:[(0,n.jsx)("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),(0,n.jsx)("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}):(0,n.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--color-text)"},children:(0,n.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,n.jsx)("audio",{ref:a,onEnded:()=>{o(!1)},onPause:()=>{c&&o(!1)},onPlay:()=>{c||o(!0)},onError:e=>{console.error("Audio error",e),o(!1)}})]})})});function s(e){let{htmlContent:t}=e,r=(0,l.useMemo)(()=>(function(e){let t,r=[],n=/<music\s+id=["']([^"']+)["'](?:\s+title=["']([^"']*)["'])?\s*(?:\/?>|>\s*<\/music>)/gi,l=[];for(;null!==(t=n.exec(e));)l.push({index:t.index,length:t[0].length,id:t[1],title:t[2]});l.sort((e,t)=>e.index-t.index);let i=0;for(let t of l)t.index>i&&r.push({type:"html",content:e.slice(i,t.index)}),r.push({type:"music",content:"",id:t.id,title:t.title}),i=t.index+t.length;return i<e.length&&r.push({type:"html",content:e.slice(i)}),r.length>0?r:[{type:"html",content:e}]})(t),[t]),[s,c]=(0,l.useState)(null),[o,a]=(0,l.useState)(null),u=(0,l.useRef)(new Set),d=(0,l.useRef)(new Map),h=(0,l.useCallback)((e,t)=>{t?(a(e),u.current.add(e)):o===e&&a(null)},[o]);return(0,l.useEffect)(()=>{let e=()=>{let e=.5*window.innerHeight,t=null,n=[];if(d.current.forEach((t,r)=>{t.getBoundingClientRect().top<e&&n.push(r)}),n.length>0)for(let e=r.length-1;e>=0;e--){let l=r[e];if("music"===l.type&&l.id&&n.includes(l.id)){t=l.id;break}}c(t)};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>window.removeEventListener("scroll",e)},[r]),(0,l.useEffect)(()=>{s?u.current.has(s)?o&&o!==s&&a(null):(u.current.add(s),a(s)):a(null)},[s,o]),(0,n.jsx)("div",{className:"prose-content relative",children:r.map((e,t)=>"music"===e.type&&e.id?(0,n.jsx)(i,{ref:t=>{t?d.current.set(e.id,t):d.current.delete(e.id)},id:e.id,title:e.title,isActive:s===e.id,isPlaying:o===e.id,onPlayStateChange:t=>h(e.id,t)},t):(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:e.content}},t))})}i.displayName="StickyMusicPlayer"},7678:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var n=r(2115);function l(){return(0,n.useLayoutEffect)(()=>{window.scrollTo(0,0)},[]),null}}},e=>{e.O(0,[619,356,441,255,358],()=>e(e.s=4455)),_N_E=e.O()}]);